A Distributed Algorithm for Fault Diagnosis in Systems with Soft Failures
ESP: a language for programmable devices
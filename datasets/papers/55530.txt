A theory of atomic transactions
Efficient and correct execution of parallel programs that share memory
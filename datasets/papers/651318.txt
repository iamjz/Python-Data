Safety, Visibility, and Performance in a Wide-Area File System
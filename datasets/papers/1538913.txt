Snapshot isolation and integrity constraints in replicated databases
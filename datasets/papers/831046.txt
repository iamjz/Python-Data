A General Framework to Solve Agreement Problems
Weak consistency: a generalized theory and optimistic implementations for distributed transactions
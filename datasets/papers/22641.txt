The logic of distributed protocols
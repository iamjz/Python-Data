Atomic snapshots of shared memory
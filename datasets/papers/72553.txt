How to write parallel programs: a guide to the perplexed
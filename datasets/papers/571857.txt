Viceroy: a scalable and dynamic emulation of the butterfly
Verdi: a framework for implementing and formally verifying distributed systems
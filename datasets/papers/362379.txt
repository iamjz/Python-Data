A model and stack implementation of multiple environments
How to generate and exchange secrets
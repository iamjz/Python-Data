Reflective program generation with patterns
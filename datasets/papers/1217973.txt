Using queries for distributed monitoring and forensics
Protocol Implementation in a Vertically Structured Operating System
Safe and efficient sharing of persistent objects in Thor